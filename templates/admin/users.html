{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4" data-aos="fade-down">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>

    <div class="row">
        <div class="col-md-12">
            <div class="card shadow" data-aos="fade-up">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>T√™n ng∆∞·ªùi d√πng</th>
                                    <th>Email</th>
                                    <th>S·ªë xu</th>
                                    <th>X·∫øp h·∫°ng</th>
                                    <th>S·ªë c√¢u h·ªèi ƒë√≥ng g√≥p</th>
                                    <th>H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>
                                        <span class="coins-display">ü™ô {{ user.coins }}</span>
                                    </td>
                                    <td>{{ user.rank }}</td>
                                    <td>{{ user.contributions|length }}</td>
                                    <td>
                                        <button type="button" class="btn btn-primary btn-sm" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#modifyCoins{{ user.id }}">
                                            <i data-feather="edit-2"></i> ƒêi·ªÅu ch·ªânh xu
                                        </button>
                                    </td>
                                </tr>
                                <!-- Coin Modification Modal -->
                                <div class="modal fade" id="modifyCoins{{ user.id }}" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">ƒêi·ªÅu ch·ªânh xu cho {{ user.username }}</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <form action="{{ url_for('modify_user_coins', user_id=user.id) }}" method="POST">
                                                <div class="modal-body">
                                                    <div class="mb-3">
                                                        <label class="form-label">ƒêi·ªÅu ch·ªânh nhanh</label>
                                                        <div class="btn-group w-100" role="group">
                                                            <button type="button" class="btn btn-outline-danger" onclick="adjustCoins(this, -5)">-5</button>
                                                            <button type="button" class="btn btn-outline-success" onclick="adjustCoins(this, 5)">+5</button>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="coinAmount" class="form-label">S·ªë xu ƒëi·ªÅu ch·ªânh</label>
                                                        <input type="number" class="form-control" id="coinAmount" 
                                                               name="coin_amount" required>
                                                        <small class="text-muted">Nh·∫≠p s·ªë d∆∞∆°ng ƒë·ªÉ th√™m xu, s·ªë √¢m ƒë·ªÉ tr·ª´ xu</small>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="reason" class="form-label">L√Ω do</label>
                                                        <textarea class="form-control" id="reason" name="reason" 
                                                                  rows="3" required></textarea>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                                                    <button type="submit" class="btn btn-primary">X√°c nh·∫≠n</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function adjustCoins(button, amount) {
    const modal = button.closest('.modal');
    const input = modal.querySelector('input[name="coin_amount"]');
    input.value = amount;
}
</script>
{% endblock %}